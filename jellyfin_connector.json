{
  "id": "jellyfin",
  "name": "Jellyfin Connector",
  "version": "2025-11-23-008",
  "description": "Kompletní konektor pro přístup k Jellyfin API s detaily, seznamy a streamem.",
  "media": ["movies", "series"],
  "type": ["catalogues", "details", "stream"],
  "website": "https://github.com/klucon/jellyfin_connector",
  "author": "klucon, panzerman",
  "baseUrl": "http://{server}/Users",
  "responseFormat": "json",

  "config": {
    "server": {
      "type": "string",
      "label": "Jellyfin Server (IP/URL)",
      "placeholder": "192.168.0.100:8096",
      "required": true
    },
    "useLogin": {
      "type": "boolean",
      "label": "Použít přihlášení (username + heslo)?",
      "default": true
    },
    "username": {
      "type": "string",
      "label": "Uživatelské jméno",
      "required": false
    },
    "password": {
      "type": "string",
      "label": "Heslo",
      "required": false
    },
    "apiKey": {
      "type": "string",
      "label": "API klíč (pokud nechceš používat login)",
      "required": false
    },
    "userId": {
      "type": "string",
      "label": "ID uživatele (nutné pro API klíč)",
      "required": false
    }
  },

  "headers": {
    "X-Emby-Authorization": "MediaBrowser Client=\"Streamlet\", Device=\"Streamlet\", DeviceId=\"streamlet01\", Version=\"1.0.0\""
  },

  "auth": {
    "enabledIf": "{useLogin}",
    "steps": [
      {
        "name": "salt",
        "method": "POST",
        "url": "/salt/",
        "body": {
          "username_or_email": "{username}"
        },
        "response": {
          "storeAs": "salt",
          "path": "response.salt",
          "status": {
            "path": "response.code",
            "states": {
              "ok": "OK",
              "userNotFound": "SALT_FATAL_1"
            }
          }
        }
      },
      {
        "name": "login",
        "method": "POST",
        "url": "/AuthenticateByName",
        "body": {
          "Username": "{username}",
          "Password": "{password}"
        },
        "response": {
          "store": {
            "apiKey": "AccessToken",
            "userId": "User.Id"
          },
          "status": {
            "path": "AccessToken",
            "states": {
              "ok": "OK",
              "error": "LOGIN_FAILED"
            }
          }
        }
      }
    ],
    "storeTokenAs": "apiKey"
  },

  "api": [
    {
      "name": "movies",
      "type": "catalogue_movies",
      "mediaType": "movie",
      "isHome": true,
      "method": "GET",
      "url": "/{userId}/Items?IncludeItemTypes=Movie&Recursive=true&SortBy=DateCreated&SortOrder=Descending&StartIndex={offset}&Limit=40&api_key={apiKey}",
      "responseFormat": "json",
      "response": {
        "itemsKey": "Items",
        "mapping": {
          "id": "Id",
          "title": "Name",
          "rating": "CommunityRating",
          "poster": "Id"
        }
      },
      "imageBaseUrl": "http://{server}/Items/{id}/Images/Primary?api_key={apiKey}"
    },
    {
      "name": "series",
      "type": "catalogue_series",
      "mediaType": "series",
      "isHome": true,
      "method": "GET",
      "url": "/{userId}/Items?IncludeItemTypes=Series&Recursive=true&SortBy=DateCreated&SortOrder=Descending&StartIndex={offset}&Limit=40&api_key={apiKey}",
      "responseFormat": "json",
      "response": {
        "itemsKey": "Items",
        "mapping": {
          "id": "Id",
          "title": "Name",
          "rating": "CommunityRating",
          "poster": "Id"
        }
      },
      "imageBaseUrl": "http://{server}/Items/{id}/Images/Primary?api_key={apiKey}"
    },
    {
      "name": "details",
      "type": "details",
      "mediaType": "movie",
      "method": "GET",
      "url": "http://{server}/Items/{id}?api_key={apiKey}",
      "responseFormat": "json",
      "response": {
        "mapping": {
          "id": "Id",
          "title": "Name",
          "overview": "Overview",
          "year": "ProductionYear",
          "genre": "Genres",
          "rating": "CommunityRating",
          "runtime": "RunTimeTicks"
        }
      },
      "imageBaseUrl": "http://{server}/Items/{id}/Images/Primary?api_key={apiKey}"
    },
    {
      "name": "series_details",
      "type": "details",
      "mediaType": "series",
      "method": "GET",
      "url": "http://{server}/Items/{id}?api_key={apiKey}",
      "responseFormat": "json",
      "response": {
        "mapping": {
          "id": "Id",
          "title": "Name",
          "overview": "Overview",
          "year": "ProductionYear",
          "genre": "Genres",
          "rating": "CommunityRating"
        }
      },
      "imageBaseUrl": "http://{server}/Items/{id}/Images/Primary?api_key={apiKey}"
    },
    {
      "name": "series_episodes",
      "type": "episodes",
      "mediaType": "series",
      "method": "GET",
      "url": "/{userId}/Items?IncludeItemTypes=Episode&ParentId={id}&SortBy=SortName&SortOrder=Ascending&Recursive=true&api_key={apiKey}",
      "responseFormat": "json",
      "response": {
        "itemsKey": "Items",
        "mapping": {
          "id": "Id",
          "title": "Name",
          "overview": "Overview",
          "episode": "IndexNumber",
          "season": "ParentIndexNumber"
        }
      },
      "imageBaseUrl": "http://{server}/Items/{id}/Images/Primary?api_key={apiKey}"
    },
    {
      "name": "stream",
      "type": "stream",
      "method": "GET",
      "url": "http://{server}/Items/{id}/PlaybackInfo?api_key={apiKey}",
      "responseFormat": "json",
      "response": {
        "itemsKey": "MediaSources",
        "mapping": {
          "url": "Path"
        }
      }
    }
  ]
}
